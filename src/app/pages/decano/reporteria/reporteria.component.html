<!-- component -->
<div class="max-w-[100%] mx-auto">
  <!-- PANEL PRINCIPAL -->
  <div
    class="relative flex flex-col w-full h-full text-slate-700 bg-white rounded-2xl shadow-md ring-1 ring-slate-200/70 px-8 sm:px-12 py-6 sm:py-8 bg-clip-border"
  >
    <div
      class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-5 gap-3"
    >
      <div>
        <h3 class="text-2xl font-semibold text-slate-900">
          Reporter√≠a Docentes
        </h3>
        <p class="text-slate-500">Reporte de todos los docentes:</p>
      </div>
      <!-- 
      <button
        class="inline-flex items-center gap-2 rounded-xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-emerald-700 transition"
      >
        üì• Exportar a Excel
      </button> -->
    </div>

    <!-- FILTROS -->
    <div class="flex flex-col sm:flex-row justify-end gap-3">
      <div class="w-full md:w-80">
        <label class="text-sm font-medium text-slate-600 mb-1 block"
          >Buscar:</label
        >
        <div class="relative h-10 w-full">
          <div
            class="absolute inset-y-0 right-3 flex items-center pointer-events-none"
          >
            <i class="fa fa-search text-slate-400"></i>
          </div>
          <input
            [(ngModel)]="filtroBusqueda"
            (input)="filtrarUsuarios()"
            class="!h-9 w-full rounded-xl px-3 py-2 pr-10 bg-white ring-1 ring-slate-200 focus:ring-2 focus:ring-blue-500/50 text-slate-700 transition"
            placeholder="Buscar docente..."
          />
        </div>
      </div>
    </div>
  </div>

  <!-- TABLA NG-ZORRO -->
  <div class="mt-6 bg-white rounded-xl shadow-sm ring-1 ring-slate-200/70 p-4">
    <nz-table
      #sortTable
      [nzData]="usuariosFiltrados"
      nzTableLayout="fixed"
      [nzFrontPagination]="true"
      [nzPageSize]="itemsPorPagina"
    >
      <thead class="bg-slate-50">
        <tr>
          @for (column of listOfColumn; track column) {

          <th
            class="text-slate-900 font-semibold"
            [nzWidth]="column.nzWidth"
            [nzSortFn]="column.compare"
          >
            {{ column.title }}
          </th>
          }
        </tr>
      </thead>

      <tbody class="divide-y divide-slate-100">
        @for (docente of sortTable.data; track docente) {
        <tr class="hover:bg-slate-50 transition-colors">
          <td>{{ docente.id }}</td>
          <td>{{ docente.c_nomdoc }}</td>
          <td>{{ docente.h_min }}</td>
          <td>{{ docente.h_max }}</td>
          <td>{{ sumarHoras(docente.horarios || []) || 0 }}</td>
          <td>
            <span
              [ngClass]="{
                'bg-blue-100 text-blue-700 ring-blue-600/20':
                  docente.tipo === 0,
                'bg-emerald-100 text-emerald-700 ring-emerald-600/20':
                  docente.tipo === 1
              }"
              class="inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ring-1 ring-inset"
            >
              {{ docente.tipo === 0 ? "Tiempo Completo" : "Tiempo Parcial" }}
            </span>
          </td>
          <td>
            <button
              nz-button
              nzType="link"
              (click)="toggleExpand(docente)"
              class="font-medium text-blue-600"
            >
              {{ docente.expanded ? "‚ñº Ocultar" : "‚ñ∂ Ver m√°s" }}
              <span
                class="bg-blue-100 text-blue-800 text-xs font-semibold ml-2 px-2 py-0.5 rounded"
              >
                {{ docente.horarios?.length || 0 }}
              </span>
            </button>
          </td>
        </tr>

        <!-- Expandible -->
        <!-- Expandible -->
        @if (docente.expanded) {
        <tr>
          <td colspan="7" class="bg-slate-50 px-6 py-4 border-t border-b">
            <p class="text-base font-semibold text-slate-800 underline mb-3">
              üóìÔ∏è Horarios Asignados:
            </p>

            <div *ngIf="docente.horarios?.length; else sinHorarios">
              <ul class="space-y-1">
                <li
                  *ngFor="
                    let h of agruparHorariosVisual(docente.horarios || [])
                  "
                  class="text-sm text-slate-700 px-3 py-1 rounded border border-slate-200 bg-white shadow-sm"
                >
                  <span class="font-medium text-slate-900">Facultad:</span>
                  {{ h.c_codfac || "‚Äî" }} |
                  <span class="font-medium text-slate-900">Especialidad:</span>
                  {{ h.c_codesp || "‚Äî" }} |
                  <span class="font-medium text-slate-900">Curso:</span>
                  {{ h.c_codcur || "‚Äî" }} - {{ h.c_nomcur || "‚Äî" }} |
                  <span class="font-medium text-slate-900">Grupo:</span>
                  {{ h.c_grpcur || "‚Äî" }} |
                  <span class="font-medium text-slate-900">Horario:</span>
                  {{ h.horarios || "‚Äî" }} |
                  <span class="font-medium text-slate-900">Modalidad:</span>
                  {{
                    h.modalidad == "pre"
                      ? "Presencial"
                      : h.modalidad == "vir"
                      ? "Virtual"
                      : h.modalidad || "‚Äî"
                  }}
                  |
                  <span class="font-medium text-slate-900">Aula:</span>
                  {{ h.aula || "‚Äî" }} |
                  <span class="font-medium text-slate-900">Total horas:</span>
                  {{ h.n_horas || 0 }}
                </li>
              </ul>
            </div>

            <ng-template #sinHorarios>
              <p class="italic text-slate-500 text-sm">
                No tiene horarios asignados.
              </p>
            </ng-template>
          </td>
        </tr>
        } }
      </tbody>
    </nz-table>
  </div>
</div>
